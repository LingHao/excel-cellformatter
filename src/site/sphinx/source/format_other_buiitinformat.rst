------------------------------------------------
ビルトインフォーマット（組み込み書式）について
------------------------------------------------

Excelの書式は、ファイル内部では *インデックス番号* に対して、 *書式のパターン* が割り振られています。

その中で、インデックス番号が 0～49は予め固定のフォーマットを持ち、ビルトインフォーマット（組み込み書式）と呼ばれます。

* Excelのバージョンによっては、インデックス番号だけ持ち、書式を持たない場合があります。
* 50番以降は、ユーザ定義用書式として、ファイルによって異なります。
* ただし、50～59番第は、Excelの言語環境によって予約された番号で、インデックス番号だけ持ち、書式をを持たない場合があります。
* ビルインフォーマットは、JExcelAPIの場合とApaceh POIでは一部異なっています。
* JExcelAPIの場合、明らかに間違った書式で定義されています。
  
  * 通貨記号を含む書式は、環境によって変わる可能性があります。


本ライブラリでは、OSの言語によって変わるような書式や間違っている書式は、予め *FormatterResolver#registerDefaultFormat()* メソッド内で登録し、正しい書式で取得できるようにしています。

.. list-table:: ビルドインフォーマットの一覧
   :widths: 5 5 25 25 20 20
   :header-rows: 1
   
   
   * - | index
       | 16進
     - | index
       | 10進
     - JExcelAPI
     - Apache POI
     - Excel
     - 備考
     
   * - 0
     - 0
     - 
     - ``General``
     - ``標準/G``
     - 
   
   * - 1
     - 1
     - ``0``
     - ``0``
     - ``0``
     - 
   
   * - 2
     - 2
     - ``0.00``
     - ``0.00``
     - ``0.00``
     - 
   
   * - 3
     - 3
     - ``#,##0``
     - ``#,##0``
     - ``#,##0``
     - 
   
   * - 4
     - 4
     - ``0.00``
     - ``#,##0.00``
     - ``#,##0.00``
     -
   
   * - 5
     - 5
     - ``($#,##0_);($#,##0)``
     - `` $#,##0_);($#,##0)``
     - ``\#,##0;\-#,##0``
     - | POI、JExcelAPIの場合、括弧が余分で、符号がなく間違っている。
       | さらに、通貨記号が異なる。
   
   * - 6
     - 6
     - ``($#,##0_);[Red]($#,##0)``
     - ``$#,##0_);[Red]($#,##0)``
     - ``\#,##0;[Red]\-#,##0``
     - | POI、JExcelAPIの場合、括弧が余分で、符号がなく間違っている。
       | さらに、通貨記号が異なる。
   
   * - 7
     - 7
     - ``($#,##0_);[Red]($#,##0)``
     - ``$#,##0.00);($#,##0.00)``
     - ``¥#,##0.00;¥-#,##0.00``
     - | POI、JExcelAPIの場合、括弧が余分で、符号がなく間違っている。
       | さらに、通貨記号が異なる。
   
   * - 8
     - 8
     - ``($#,##0.00_);[Red]($#,##0.00)``
     - ``$#,##0.00_);[Red]($#,##0.00)``
     - ``\#,##0.00;[Red]\-#,##0.00``
     - | POI、JExcelAPIの場合、括弧が余分で、符号がなく間違っている。
       | さらに、通貨記号が異なる。
   
   * - 9
     - 9
     - ``0%``
     - ``0%``
     - ``0%``
     - 
   
   * - a
     - 10
     - ``0.00%``
     - ``0.00%``
     - ``0.00%``
     - 
   * - b
     - 11
     - ``0.00E+00``
     - ``0.00E+00``
     - ``0.00E+00``
     - 
   
   * - c
     - 12
     - ``# ?/?``
     - ``# ?/?``
     - ``# ?/?``
     - 
   
   * - d
     - 13
     - ``# ??/??``
     - ``# ??/??``
     - ``# ??/??``
     - 
   
   * - e
     - 14
     - ``dd/mm/yyyy``
     - ``m/d/yy``
     - ``m/d/yy``
     - JexcelAPIの場合、間違っている。
   
   * - f
     - 15
     - ``d-mmm-yy``
     - ``d-mmm-yy``
     - ``d-mmm-yy``
     - 
   
   * - 10
     - 16
     - ``d-mmm``
     - ``d-mmm``
     - ``d-mmm``
     - 
   
   * - 11
     - 17
     - ``mmm-yy``
     - ``mmm-yy``
     - ``mmm-yy``
     - 
   
   * - 12
     - 18
     - ``h:mm AM/PM``
     - ``h:mm AM/PM``
     - ``h:mm AM/PM``
     - 
   
   * - 13
     - 19
     - ``h:mm:ss AM/PM``
     - ``h:mm:ss AM/PM``
     - ``h:mm:ss AM/PM``
     - 
   
   * - 14
     - 20
     - ``h:mm``
     - ``h:mm``
     - ``h:mm``
     - 
   
   * - 15
     - 21
     - ``h:mm:ss``
     - ``h:mm:ss``
     - ``h:mm:ss``
     - 
   
   * - 16
     - 22
     - ``m/d/yy h:mm``
     - ``m/d/yy h:mm``
     - ``m/d/yy h:mm``
     - 
   
   * - 25
     - 37
     - ``(#,##0_);(#,##0)``
     - ``#,##0_);(#,##0)``
     - ``#,##0;-#,##0``
     - | POI、JExcelAPIの場合、括弧が余分、符号がなく間違っている。
   
   * - 26
     - 38
     - ``(#,##0_);[Red](#,##0)``
     - ``#,##0_);[Red](#,##0)``
     - ``#,##0;[Red]-#,##0``
     - | POI、JExcelAPIの場合、括弧が余分、符号がなく間違っている。
   
   * - 27
     - 39
     - ``(#,##0.00_);(#,##0.00)``
     - ``#,##0.00_);(#,##0.00)``
     - ``#,##0.00;-#,##0.00``
     - POI、JExcelAPIの場合、括弧が余分、符号がなく間違っている。
   
   * - 28
     - 40
     - ``(#,##0.00_);[Red](#,##0.00)``
     - ``#,##0.00_);[Red](#,##0.00)``
     - ``#,##0.00;[Red]-#,##0.00``
     - POI、JExcelAPIの場合、括弧が余分、符号がなく間違っている。
   
   * - 29
     - 41
     - ``_(*#,##0_);_(*(#,##0);_(*\"-\"_);(@_)``
     - ``_(* #,##0_);_(* (#,##0);_(* \"-\"_);_(@_)``
     - ``_ * #,##0_ ;_ * \\-#,##0_ ;_ * \"-\"_ ;_ @_``
     - POI、JExcelAPIの場合、符号がなく間違っている。
   
   * - 2a
     - 42
     - ``_($*#,##0_);_($*(#,##0);_($*\"-\"_);(@_)``
     - ``_($* #,##0_);_($* (#,##0);_($* \"-\"_);_(@_)``
     - ``_ \"\\"* #,##0_ ;_ \"\\"* \\-#,##0_ ;_ \"\\"* \"-\"_ ;_ @_``
     - JExcelAPI、POIの場合、符号がなく、通貨記号が異なる。
   
   * - 2b
     - 43
     - ``_(* #,##0.00_);_(* (#,##0.00);_(* \"-\"??_);(@_)``
     - ``_(* #,##0.00_);_(* (#,##0.00);_(* \"-\"??_);_(@_)``
     - ``_ * #,##0.00_ ;_ * (#,##0.00);_ * \"-\"??_ ;_ @_ ``
     - JExcelAPIの場合、文字列の書式が間違っている。
   
   * - 2c
     - 44
     - ``_($* #,##0.00_);_($* (#,##0.00);_($* \"-\"??_);(@_)``
     - ``_($* #,##0.00_);_($* (#,##0.00);_($* \"-\"??_);_(@_)``
     - ``_ \"\\"* #,##0.00_ ;_ \"\\"* -#,##0.00_ ;_ \"\\"* \"-\"??_ ;_ @_ "``
     - JExcelAPI、POIの場合、通貨記号が異なる。
   
   * - 2d
     - 45
     - ``mm:ss``
     - ``mm:ss``
     - ``mm:ss``
     - 
   
   * - 2e
     - 46
     - ``[h]mm:ss``
     - ``[h]:mm:ss``
     - ``[h]:mm:ss``
     - JExcelAPIの場合、コロン":"が足りない。
   
   * - 2f
     - 47
     - ``mm:ss.0``
     - ``mm:ss.0``
     - ``mm:ss.0``
     - 
   
   * - 30
     - 48
     - ``##0.0E+0``
     - ``##0.0E+0``
     - ``##0.0E+0``
     - 
   
   * - 31
     - 49
     - ``@``
     - ``@``
     - ``@``
     - 


^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
JExcelAPIによる書式のインデックスの取得
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* JExcelAPIでは、書式のインデックスの取得は基本的には *DisplayFormat#getFormatIndex()* から取得します。
* ビルトインフォーマットの定義は、非公開のクラス *jxl.biff.BuiltInfFomrat* で定義されています。
* 本ライブラリでは、 *JXLCell#getFormatIndex()* で実装されている。

.. sourcecode:: java

    final CellFormat cellStyle = cell.getCellFormat();
    if(cellStyle == null) {
        // 書式を持たない場合
        return 0;
    }
    
    final Format cellFormat = cellStyle.getFormat();
    if(cellFormat == null && cellStyle instanceof XFRecord) {
        final XFRecord record = (XFRecord) cellStyle;
        return (short) record.formatIndex;
        
    } else if(cellFormat == null) {
        // 書式を持たない場合
        return 0;
    }
    
    if(cellFormat instanceof DisplayFormat) {
        final DisplayFormat displayFormat = (DisplayFormat)cellFormat;
        return (short) displayFormat.getFormatIndex();
    }
    
    // 不明な場合
    return 0;
    

^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Apache POIによる書式のインデックスの取得
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

* Apache POIの書式のインデックスは、 *CellSyle#getDataFormat()* から取得します。

.. sourcecode:: java
   
   short formatIndex = cell.getCellStyle().getDataFormat();


